# 黑群晖系统虚拟机安装记录

## 准备工作

### 安装包准备

需要准备用于安装系统的系统引导和系统安装包

建议通过[nas2x.com](https://www.nas2x.com/)论坛中查询并下载

系统引导是一个名为“synoboot.img”的文件

系统安装包是一个后缀为“.part”的文件



本次安装的是DSM6.2系统，版本是DS918+_24922

系统引导为：synoboot.img

系统安装包为：DSM_DS918+_24922.pat



需要特别注意的是：系统引导和系统安装包是配对使用，如果版本不匹配则无法成功安装系统。本次的系统引导就是“DSM_DS918+_24922.pat”专用的，下载的时候请注意安装包的说明。

### 虚拟机准备

虚拟机采用的是“VMware workstation 15 pro”，可以通过VMware官网下载。

### 安装辅助工具准备

1. StarWindConverter(虚拟引导格式转换工具)

   该工具能够将将“synoboot.img“格式的系统引导转换为VMware格式的”synoboot.vmdk“和”synoboot-flat.vmdk“两个虚拟硬盘文件。

2. synology-assistant(在局域网中查询群晖nas的工具)(可选)

   该工具可以快速查询局域网中的群晖nas系统

   群晖也提供无需安装工具的方式，通过一个url：http://find.synology.com 也能查询局域网中的nas系统。

   **注意**，执行查询的设备要和nas处于同一个局域网网段中才能找到nas。

## 虚拟机安装和配置

### 安装VMware

VMware提供了图形化的安装界面，安装过程非常方便。通过图形界面的引导即可完成安装。

### 转换引导格式

使用StarWindConverter工具，将”synoboot.img“转换为**VMware pre-allocated image**，获得”synoboot.vmdk“和”synoboot-flat.vmdk“两个虚拟硬盘文件。

### 新建虚拟机

在VMware workstation中新建一台用于运行群晖系统的虚拟机

1. 在VMware workstation主页

   1. 点击**文件**菜单，在下拉选项中选择**新建虚拟机**，该操作会弹出**新建虚拟机向导窗口**

2. 在新建虚拟向导窗口

   1. 选择**自定义(高级)**，点击下一步

   2. 选择**硬件兼容性：Workstation 15.x**， 点击下一步

   3. 选择**稍后安装系统**，点击下一步

   4. 选择**客户机操作系统：Linux**

      选择**版本：其他 Linux 3.x 内核 64 位**，点击下一步

   5. 自定义**虚拟机名称**和虚拟机**位置**，点击下一步

   6. 配置虚拟机处理器，**针对群晖系统**建议：

      **处理器数量：2**

      **每个处理器的内核数量：1**

      点击下一步

   7. 配置虚拟机内存容量，**针对群晖系统**建议：

      **容量为：4096MB**

      点击下一步

   8. 配置虚拟机的网络连接方式

      有两种场景：本机使用和局域网使用

      1. 本机使用

         在该场景下，网络连接选择**使用仅主机模式网络**

         该模式会通过一张虚拟网卡，将物理机虚拟成一个网关，虚拟机是网关中的一个用户。通过这样的方式实现物理机和虚拟机的网络联通。该模式下，虚拟机所在的网段和物理机外部网段不一致，因此，只有物理机能访问虚拟机。

      2. 局域网使用

         在该场景下，网络连接选择**使用桥接网络**

         该模式下，虚拟机会通过物理机的物理网卡直接同物理机所在的网络连接，获得和物理机相同网段的IP地址。因此，物理机所在网段的其他终端都能访问虚拟机。

      配置完成后点击下一步

   9. 配置虚拟机的I/O控制器类型，使用默认设置即可，直接点击下一步

   10. 虚拟机的虚拟磁盘配置，针对群晖系统：

       必须设置**虚拟磁盘类型为：SATA**

       因为群晖系统智能识别该类型的磁盘

       安装系统至少需要配置两个磁盘，一个磁盘是用于引导，另一个磁盘用于实际存储。

       1. 引导磁盘
          1. 引导磁盘必须是第一个磁盘，否者开机后虚拟机会出现找不到系统的报错
          2. 用于引导的磁盘在之前已经利用StarWindConverter完成转换。
          3. 在选择磁盘页面中，选择**使用现有虚拟磁盘**
          4. 输入磁盘路径，点击下一步后会点出提示窗口，选择该窗口中的**保持原有格式**
       2. 存储磁盘
          1. 注意：存储磁盘是在虚拟机建立好之后，进行添加，因为虚拟机新建的时候只能配置一个因硬盘
          2. 选择**创建新虚拟磁盘**
          3. 设定最大磁盘大小，**最少需要8GB**
       
   11. 完成虚拟机新建配置

### 虚拟机配置更改

1. **添加存储磁盘**，在在VMware workstation主页中，我的计算机中，找到上一步新建的虚拟机。选择编辑虚拟机设置，在弹出的界面中硬件页面下，选择添加硬盘，硬盘的配置方式同新建虚拟机中一样
2. **移除虚拟光驱**，在虚拟机设置界面中的硬件页面下，选着虚拟光驱，点击移除。

## 群晖系统安装

### 开启虚拟机

在在VMware workstation主页中，我的计算机中，找到虚拟机。点击虚拟机页面中的**开启此虚拟机**

虚拟机会自动载入第一个硬盘中的群晖系统引导自动运行，当虚拟机界面显示一段包含http://find.synology.com的介绍时，表示引导正常开机。

### 进入系统安装web页面

通过http://find.synology.com页面搜索或者使用synology-assistant工具查找到nas，进入安装web页面。

1. 点击安装web页面中的**联机**
2. 点击安装web页面中的**设置**
3. 点**手动安装**，在弹出页面中将“DSM_DS918+_24922.pat”(或者是其他群晖系统)的路输入后，点击**立即安装**。
4. 在弹出的格式化警告框中，**选择我了解这些硬盘上的所有书记将被删除**，然后点击确定。
5. 等待安装直至虚拟机重启，安装页面自动刷新为登录页面，至此安装完成

## 安装之后

1. 进入群晖系统后，请将自动升级关闭，自动升级可能回导致黑群晖系统崩溃等严重问题。
2. 黑群晖不能使用群晖提供的任何账号服务，遇到这类设置全部跳过。



​       

​       

​       

​       

